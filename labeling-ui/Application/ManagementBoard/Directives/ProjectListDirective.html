<div class="grid-block vertical" id="project-list-table">
  <loading-mask ng-if="vm.loadingInProgress" spinner="true"></loading-mask>
  <!--
      Display proper no projects information
  -->
  <div class="view-list-info-box" ng-if="vm.projects.length == 0" ng-switch="vm.loadingInProgress">
    <h3 ng-switch-when="true">Loading projects...</h3>
    <h3 ng-switch-default>There are currently no projects in the selected state.</h3>
  </div>

  <table class="table hover view-list-table"
         pagination-table
         storage-identifier="project-list-with-status-{{vm.projectStatus}}"
         total-rows="vm.totalRows"
         items-per-page="100"
         on-page-update="vm.updatePage(page, itemsPerPage)">
    <!--
         Display real information
     -->
    <thead ng-if="vm.projects.length > 0">
      <tr>
        <th ng-repeat="column in vm.columns track by $index">{{column.name}}</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody ng-if="vm.projects.length > 0">
      <tr>
      <tr ng-repeat="project in vm.projects track by project.id" id="{{'project-row-' + projectIndex}}"
          ng-init="projectIndex = $index" ng-click="project.status != 'deleted' && vm.openProject(project)">
        <td ng-repeat="column in vm.columns track by $index">
          <div class="table-background-progress" ng-init="result = vm.calculateProjectProgressFromDuration(project)"
               ng-if="$index == 0"
               ng-style="{left: result.progress, height: vm.calculateTableRowHeight(projectIndex)}"
               ng-class="result.class"
          >
          </div>
          <div class="table-tr-div-background" ng-if="$index == 0"
               ng-style="{background: projectIndex % 2 == 0 ? '#D0D6DD' : '#D7DDE4', height:vm.calculateTableRowHeight(projectIndex)}"
          >
          </div>
          <i class="icon icon-medium icon-legacy-project"
             ng-if="column.property === 'name' && project.taskInstructionType === 'legacy'"></i>
          <i class="icon icon-medium icon-requirements-xml-project"
             ng-if="column.property === 'name' && project.taskInstructionType === 'requirementsXml'"></i>
          <i class="icon icon-medium icon-simple-xml-project"
             ng-if="column.property === 'name' && project.taskInstructionType === 'genericXml'"></i>

          {{project[column.property]}}

          <span class="tagDisplay" ng-if="column.property === 'name'" ng-repeat="campaign in project.campaigns">
            {{campaign.name}}
          </span>

          <i ng-if="column.property === 'taskCount' && project.taskInPreProcessingCount > 0"
             class="fa fa-spin fa-spinner"
             tooltip="Import in progress. {{project.taskInPreProcessingCount}} are not finished yet."></i>
          <span ng-if="column.property === 'taskCount' && project.taskInPreProcessingCount > 0">({{project.taskInPreProcessingCount}})</span>
          <i ng-if="column.property === 'taskCount' && project.taskFailedCount > 0"
             class="fa fa-warning" tooltip="Failed to create {{project.taskFailedCount}} tasks."></i>
        </td>

        <td class="action-cell" ng-click="$event.stopPropagation()" ng-init="vm.createActionButtons(project)">
          <span class="x-split-button" id="action-project-id-{{project.id}}" ng-class="{'open': vm.openActionsToggle[project.id] === true}">
            <button
                    tooltip="{{vm.leadActionButton.text}}"
                    ng-if="vm.leadActionButton.visible"
                    ng-click="vm.leadActionButton.action()"
                    ng-class="[vm.leadActionButton.ngClass, {'single-action': vm.isActionDropDownVisible() === false}]"
                    class="x-button x-button-main"
            >
                <i class="fa" ng-class="vm.leadActionButton.icon"></i>
                  {{vm.leadActionButton.shortText}}
                <i ng-if="vm.showUploadSpinner(project)"
                   class="fa fa-spin fa-spinner">
                </i>
            </button>
            <button class="x-button x-button-drop"
                    ng-click="vm.toggleActions(project.id)"
                    ng-show="vm.isActionDropDownVisible()"
              >
              &#9660;
            </button>
          </span>
        </td>
      </tr>
    </tbody>
    <tfoot ng-if="vm.projects.length > 0">
      <tr>
        <td colspan="{{vm.columns.length + 1}}">
          <pagination-controls></pagination-controls>
        </td>
      </tr>
    </tfoot>

  </table>
  <ul class="x-button-drop-menu" id="action-container" ng-style="{'display': vm.openActionsToggle[vm.selectedProjectId] === true ? 'block' : 'none', 'left': vm.actionsButtonDropDownLeftStyle, 'top': vm.actionsButtonDropDownTopStyle}">
    <li ng-repeat="actionButton in vm.actionButtons" ng-click="actionButton.action()">
      <button tooltip="{{actionButton.text}}"
              ng-if="actionButton.visible"

      >
        <i class="fa" ng-class="actionButton.icon"></i> {{actionButton.shortText}}
      </button>
    </li>
  </ul>
</div>
