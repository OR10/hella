<%
# Originally taken from: https://michielkalkman.com/snippets/nginx-cors-open-configuration.html
%>
<% if @allowed_origin != nil %>
if ($request_method = 'OPTIONS') {
    add_header 'Access-Control-Allow-Origin' '<%= @allowed_origin %>';
    add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS';
    add_header 'Content-Length' 0;
    return 204;
}

if ($request_method = 'GET') {
    add_header 'Access-Control-Allow-Origin' '<%= @allowed_origin %>';
    add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS';
}
<% else %>
# allowed origin is not configured
<% end %>
