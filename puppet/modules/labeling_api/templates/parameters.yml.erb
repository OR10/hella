# This file is auto-generated during the composer install
parameters:
    cache_dir: <%= @cache_dir %>

    database_host: <%= @database_host %>
    database_port: <%= @database_port %>
    database_name: <%= @database_name %>
    database_name_read_only: <%= @database_name_read_only %>
    database_user: <%= @database_user %>
    database_password: <%= @database_password %>

    couchdb_host: <%= @couchdb_host %>
    couchdb_host_external: <%= @couchdb_host_external %>
    couchdb_port: <%= @couchdb_port %>
    couchdb_port_external: <%= @couchdb_port_external %>
    couchdb_user: <% if @couchdb_user != nil %><%= @couchdb_user %><% else %>~<% end %>
    couchdb_password: <% if @couchdb_password != nil %><%= @couchdb_password %><% else %>~<% end %>
    couchdb_user_read_only: <%= @couchdb_user_read_only %>
    couchdb_password_read_only: <%= @couchdb_password_read_only %>
    couchdb_external_url: <%= @couchdb_external_url %>
    couchdb_path_external: <%= @couchdb_path_external %>

    fos_user_bundle_to_couchdb_sync_enabled: <%= @fos_user_bundle_to_couchdb_sync_enabled %>

    pouchdb_feature_enabled: <%= @pouchdb_feature_enabled %>

    mailer_transport: <%= @mailer_transport %>
    mailer_host: <%= @mailer_host %>
    mailer_user: <%= @mailer_user %>
    mailer_password: <%= @mailer_password %>

    secret: <%= @secret %>

    ffmpeg_executable: <%= @ffmpeg_executable %>
    ffprobe_executable: <%= @ffprobe_executable %>

    frame_cdn_dir: <%= @frame_cdn_dir %>
    video_cdn_dir: <%= @video_cdn_dir %>

    <% if @frame_cdn_type == 's3' %>
    frame_cdn_s3_base_url: <%= @frame_cdn_s3_base_url %>
    frame_cdn_s3_region: <%= @frame_cdn_s3_region %>
    frame_cdn_s3_bucket: <%= @frame_cdn_s3_bucket %>
    frame_cdn_s3_key: <%= @frame_cdn_s3_key %>
    frame_cdn_s3_secret: <%= @frame_cdn_s3_secret %>
    <% end %>

    <% if @video_cdn_type == 's3' %>
    video_cdn_s3_base_url: <%= @video_cdn_s3_base_url %>
    video_cdn_s3_region: <%= @video_cdn_s3_region %>
    video_cdn_s3_bucket: <%= @video_cdn_s3_bucket %>
    video_cdn_s3_key: <%= @video_cdn_s3_key %>
    video_cdn_s3_secret: <%= @video_cdn_s3_secret %>
    <% end %>

    <% if @frame_cdn_type == 's3-cmd' || @video_cdn_type == 's3-cmd'  %>
    s3cmd_executable: "<%= @s3cmd_executable %>"
    parallel_executable: "<%= @parallel_executable %>"
    <% end %>

    <% if @frame_cdn_type == 's3-cmd' %>
    frame_cdn_s3_parallel_uploads_per_worker: "<%= @frame_cdn_s3_parallel_uploads_per_worker %>"
    frame_cdn_s3_host_base: "<%= @frame_cdn_s3_host_base %>"
    frame_cdn_s3_host_bucket: "<%= @frame_cdn_s3_host_bucket %>"
    frame_cdn_s3_bucket: "<%= @frame_cdn_s3_bucket %>"
    frame_cdn_s3_key: "<%= @frame_cdn_s3_key %>"
    frame_cdn_s3_secret: "<%= @frame_cdn_s3_secret %>"
    <% end %>

    <% if @video_cdn_type == 's3-cmd' %>
    video_cdn_s3_parallel_uploads_per_worker: "<%= @video_cdn_s3_parallel_uploads_per_worker %>"
    video_cdn_s3_host_base: "<%= @video_cdn_s3_host_base %>"
    video_cdn_s3_host_bucket: "<%= @video_cdn_s3_host_bucket %>"
    video_cdn_s3_bucket: "<%= @video_cdn_s3_bucket %>"
    video_cdn_s3_key: "<%= @video_cdn_s3_key %>"
    video_cdn_s3_secret: "<%= @video_cdn_s3_secret %>"
    <% end %>

    frame_cdn_base_url: <%= @frame_cdn_base_url %>

    <% if @user_password != nil %>
    user_password: <%= @user_password %>
    <% end %>

    rabbitmq_host: <%= @rabbitmq_host %>
    rabbitmq_port: <%= @rabbitmq_port %>
    rabbitmq_vhost: <%= @rabbitmq_vhost %>
    rabbitmq_user: <%= @rabbitmq_user %>
    rabbitmq_password: <%= @rabbitmq_password %>
    rabbitmq_use_alternate_exchange: <%= @rabbitmq_use_dead_letter_exchange %>
    rabbitmq_use_dead_letter_exchange: <%= @rabbitmq_use_alternate_exchange %>
    rabbitmq_management_port: <%= @rabbitmq_management_port %>

    redis_host: <%= @redis_host %>
    redis_port: <%= @redis_port %>

oneup_flysystem:
    adapters:
<% if @frame_cdn_type == 's3-cmd' || @frame_cdn_type == 'filesystem' %>
        frame_cdn_dir_adapter:
            local:
                directory: %frame_cdn_dir%
<% end %>
<% if @video_cdn_type == 's3-cmd' || @video_cdn_type == 'filesystem' %>
        video_cdn_dir_adapter:
            local:
                directory: %video_cdn_dir%
<% end %>
<% if @frame_cdn_type == 's3' %>
        frame_cdn_dir_adapter:
            awss3v3:
                client: frame_cdn.s3_client
                bucket: "%frame_cdn_s3_bucket%"
<% end %>
<% if @video_cdn_type == 's3' %>
        video_cdn_dir_adapter:
            awss3v3:
                client: video_cdn.s3_client
                bucket: "%video_cdn_s3_bucket%"
<% end %>

services:
<% if @frame_cdn_type == 's3-cmd' %>
    annostation.labeling_api.service.s3_cmd_frame_cdn:
        class: AnnoStationBundle\Service\S3Cmd
        arguments:
            - '%s3cmd_executable%'
            - '%parallel_executable%'
            - '%frame_cdn_s3_parallel_uploads_per_worker%'
            - '%cache_dir%'
            - '%frame_cdn_s3_bucket%'
            - '%frame_cdn_s3_key%'
            - '%frame_cdn_s3_secret%'
            - '%frame_cdn_s3_host_base%'
            - '%frame_cdn_s3_host_bucket%'
    annostation.labeling_api.service.frame_cdn.s3_cmd:
        class: AnnoStationBundle\Service\FrameCdn\S3Cmd
        arguments:
            - '%frame_cdn_base_url%'
            - '%cache_dir%'
            - '@annostation.labeling_api.service.s3_cmd_frame_cdn'
            - '@annostation.labeling_api.vendor.logger'
    annostation.labeling_api.service.frame_cdn.selected-alias:
            alias: annostation.labeling_api.service.frame_cdn.s3_cmd
<% end %>
<% if @video_cdn_type == 's3-cmd' %>
    annostation.labeling_api.service.s3_cmd_video_cdn:
        class: AnnoStationBundle\Service\S3Cmd
        arguments:
            - '%s3cmd_executable%'
            - '%parallel_executable%'
            - '%video_cdn_s3_parallel_uploads_per_worker%'
            - '%cache_dir%'
            - '%video_cdn_s3_bucket%'
            - '%video_cdn_s3_key%'
            - '%video_cdn_s3_secret%'
            - '%video_cdn_s3_host_base%'
            - '%video_cdn_s3_host_bucket%'
    annostation.labeling_api.service.video_cdn.s3_cmd:
        class: AnnoStationBundle\Service\VideoCdn\S3Cmd
        arguments:
            - '@annostation.labeling_api.service.s3_cmd_video_cdn'
            - '@annostation.labeling_api.vendor.logger'
    annostation.labeling_api.service.video_cdn.selected-alias:
        alias: annostation.labeling_api.service.video_cdn.s3_cmd
<% end %>
<% if @frame_cdn_type == 's3' %>
    frame_cdn.s3_client:
        class: Aws\S3\S3Client
        arguments:
            -
                version: 'latest'
                region: "%frame_cdn_s3_region%"
                endpoint: '%frame_cdn_s3_base_url%'
                validate: false
                bucket_endpoint: true
                credentials:
                    key: "%frame_cdn_s3_key%"
                    secret: "%frame_cdn_s3_secret%"
<% end %>
<% if @video_cdn_type == 's3' %>
    video_cdn.s3_client:
        class: Aws\S3\S3Client
        arguments:
            -
                version: 'latest'
                region: "%video_cdn_s3_region%"
                endpoint: '%video_cdn_s3_base_url%'
                validate: false
                bucket_endpoint: true
                credentials:
                    key: "%video_cdn_s3_key%"
                    secret: "%video_cdn_s3_secret%"
<% end %>
<% if @fos_user_bundle_to_couchdb_sync_enabled == true %>
    annostation.labeling_api.database.facade.user.selected-alias:
        alias: annostation.labeling_api.database.facade.user_with_couch_db_sync
<% end %>